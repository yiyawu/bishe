!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.BoardSDK=e():t.BoardSDK=e()}(this,function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.i=function(t){return t},r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=16)}([function(t,e,r){"use strict";t.exports={VERSION:"2.1.0",PLATFORM:"web",SERVER_URL:"https://yun.tim.qq.com/v4/ilvb_edu/whiteboard?contenttype=json&sdkappid=",TEST_SERVER_URL:"https://test.tim.qq.com/v4/ilvb_test/whiteboard?contenttype=json&sdkappid=",SUB_CMD:{GET_BOARD_DATA:"get_board_data",REPORT_BOARD_DATA:"report_board_data"},COMMON_GROUP:"#DEFAULT",COMMON_DEFAULT_BOARD:"#DEFAULT",THIN:100,RADIUS:100,PROTOCOL_ACTION:{LINE_START_ACTION:1,LINE_MOVE_ACTION:2,LINE_END_ACTION:3,RASER_SHOW_ACTION:6,RASER_HIDE_ACTION:7,ERASER_ACTION:8,MOVE_LINE_GRAPH_ACTION:9,GRAPH_LINE_ACTION:10,GRAPH_CIRCLE_ACTION:11,GRAPH_RECT_ACTION:12,GRAPH_CLEAR_ALL_ACTION:101,GRAPH_CLEAR_ACTION:102,UPDATE_BG_IMG_ACTION:201,DELETE_BG_IMG_ACTION:202,UPDATE_BG_COLOR_ACTION:203,BOARD_MOVE_SCALE_ACTION:301,SWITCH_ACTION:401}}},function(t,e,r){"use strict";t.exports={decimalToRgba:function(t){var e=[];return t.replace(/../g,function(t){e.push(parseInt(t,16))}),"rgba("+e.join(",")+",1)"},hexToRgba:function(t){var e;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(t))return 3==(e=t.substring(1).split("")).length&&(e=[e[0],e[0],e[1],e[1],e[2],e[2]]),t="#"+e.join(""),"rgba("+parseInt("0x"+t.slice(1,3))+","+parseInt("0x"+t.slice(3,5))+","+parseInt("0x"+t.slice(5,7))+",1)"},rgbaToDecimal:function(t){for(var e=t.toString().match(/\d+/g),r="",i=0;i<3;i++)r+=("0"+Number(e[i]).toString(16)).slice(-2);return r},dealColor:function(t){if(t<0)return"rgba("+(t>>24&255)+","+(t>>16&255)+","+(t>>8&255)+",1)";var e=parseInt(t).toString(16);return e=(e="000000"+(e=e.substr(0,e.length-2))).substring(e.length-6,e.length),this.decimalToRgba(e)},formatColor:function(t){var e=this.rgbaToDecimal(t);return parseInt(e+"ff",16)},getTimeStamp:function(){return(new Date).getTime()},getSecondTime:function(){return parseInt(this.getTimeStamp()/1e3)},getTimeDiff:function(t){return(new Date).getTime()-t}}},function(t,e,r){"use strict";function i(){}i.prototype.on=function(t,e){return this._cbs=this._cbs||{},(this._cbs[t]||(this._cbs[t]=[])).unshift(e),this},i.prototype.off=function(t,e){if(this._cbs=this._cbs||{},!t)return this._cbs={};if(!e)return delete this._cbs[t];for(var r,i=this._cbs[t]||[];i&&~(r=i.indexOf(e));)i.splice(r,1);return this},i.prototype.fire=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,e=arguments[1],r=arguments[2];this._cbs=this._cbs||{};var i=this._cbs[e];if(i)for(var o=i.length;o--;)i[o].apply(t,[r]);return this},t.exports=new i},function(t,e,r){"use strict";t.exports={BOARD_ACTION_TYPE:{LINE:"line",ERASER:"eraser",RASER:"raser",POINTSELECT:"pointselect",SELECT:"select",MOVE:"move","GRAPH-LINE":"graph-line","GRAPH-CIRCLE":"graph-circle","GRAPH-RECT":"graph-rect","GRAPH-OVAL":"graph-oval","GRAPH-CIRCLE-SOLID":"graph-circle-solid","GRAPH-RECT-SOLID":"graph-rect-solid","GRAPH-OVAL-SOLID":"graph-oval-solid"},COLOR:{RED:4278190335,WHITE:4294967295},EVENT:{HISTROY_DATA_COMPLETE:"histroy_data_complete",ADD_BOARD:"add_board",RT_DATA:"real_time_data",DELETE_BOARD:"delete_board",SWITCH_BOARD:"switch_board",ADD_GROUP:"add_group",DELETE_GROUP:"delete_group",SWITCH_GROUP:"switch_group",IMG_START_LOAD:"img_start_load",IMG_LOAD:"img_load",IMG_ERROR:"img_error",IMG_ABORT:"img_abort",PRELOAD:"preload"}}},function(t,e,r){"use strict";var i=r(12);t.exports={seq:0,getSeq:function(){var t=Math.round((new Date).getTime()/1e3);return 1*new i(t>>>0<<15|32767&this.seq++,t>>>0>>17).toString()}}},function(t,e,r){"use strict";var i;function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var n=r(1),s=r(0);function a(){}a.prototype={APIURL:"https://ilivelog.qcloud.com",method:"POST",events:{start_draw_curve:"start_draw_curve",move_draw_curve:"move_draw_curve",end_draw_curve:"end_draw_curve",over_draw_curve:"over_draw_curve",start_raser:"start_raser",end_raser:"end_raser",eraser:"eraser",move_scrawl:"move_scrawl",draw_graph:"draw_graph",clear_all:"clear_all",clear_scrawl:"clear_scrawl",set_bg_img:"set_bg_img",clear_bg_img:"clear_bg_img",set_bg_color:"set_bg_color",switch_board:"switch_board",start_select:"start_select",move_select:"move_select",end_select:"end_select",point_select:"point_select"},levels:{info:"info",warn:"warn",error:"error"},send:function(t){try{t.userAgent=navigator.userAgent,t=this.fillDatas(t);var e=this.getXHR();e.onreadystatechange=this.reporterHandel(this),e.open(this.method,this.APIURL,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(JSON.stringify(t))}catch(t){console.log(t)}},fillDatas:function(t){var e={};for(var r in this.defDatas)["sdkappid","classid","userid"].indexOf(r)>=0?e[r]=this.defDatas[r]:e[r]=void 0!==t[r]?t[r]:this.defDatas[r];return e},datasParseToString:function(t){var e=[];for(var r in t)e.push(r+"="+encodeURIComponent(t[r]));return e.join("&")},getXHR:function(){var t=null;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}if(null!=t)return t;console.log("Your browser does not support XMLHTTP.")},reporterHandel:function(){return function(t){t&&t.readyState&&t.readyState}},log:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.info})},warn:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.warn})},error:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.error})},defDatas:(i={action:"",version:s.VERSION,action_result:0,action_info:"",userid:"",time_consume:0,sdkappid:"",device:"web",log_time:0,business:"ticsdk",roomid:"",boardid:"",image_url:"",boardid_list:[],to_boardId:"",color:null,file_id:"",file_title:"",isfinish:0,msgLength:20,bucket:"",cos_appid:null,extra_info:"",net_type:"unknown"},o(i,"net_type",null),o(i,"userAgent",null),i),setSdkAppid:function(t){void 0!=t&&null!=t?this.defDatas.sdkappid=t:console.log("sdkappid invalid!")},setRoomId:function(t){void 0!=t&&null!=t?this.defDatas.roomid=t:console.log("roomid invalid!")},setUserId:function(t){void 0!=t&&null!=t?this.defDatas.userid=t:console.log("userid invalid!")},boardAction:function(t,e){this.report(t,e)},report:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{this.send(Object.assign({action_result:0,time_consume:0},e,{action:t,log_time:n.getSecondTime()}))}catch(t){}}},t.exports=new a},function(t,e,r){"use strict";t.exports=function(t,e){this.user=t,this.type="graph",this.graph=e.graph,this.seq=e.seq,this.show=e.show,this.status="begin",this.select=!1,this.time=parseInt(+new Date/1e3,10),this.color=e.color,this.thin=e.thin,this.solid=e.solid||!1,this.startPoint={x:e.beginPoint.x,y:e.beginPoint.y,seq:e.beginPoint.seq},this.endPoint={x:e.endPoint.x,y:e.endPoint.y,seq:e.endPoint.seq}}},function(t,e,r){"use strict";function i(t,e){this.user=t,this.type="line",this.seq=e.belongSeq,this.belongSeq=e.belongSeq,this.show=e.show,this.status="begin",this.select=!1,this.color=e.color,this.time=parseInt(+new Date/1e3,10),this.thin=e.thin,this.startSeq=e.belongSeq,this.endSeq=0,this.lines=[{x:e.x,y:e.y,belongSeq:e.belongSeq,seq:e.seq}],this.border={maxX:e.x,maxY:e.y,minX:e.x,minY:e.y}}i.prototype.setBorder=function(t,e){t+this.thin>this.border.maxX&&(this.border.maxX=t+this.thin),t-this.thin<this.border.minX&&(this.border.minX=t-this.thin),e+this.thin>this.border.maxY&&(this.border.maxY=e+this.thin),e-this.thin<this.border.minY&&(this.border.minY=e-this.thin)},i.prototype.sort=function(){this.lines.sort(function(t,e){return t.seq-e.seq})},t.exports=i},function(t,e,r){"use strict";t.exports=function(t,e){this.user=t,this.type=e.type,this.seq=e.seq}},function(t,e,r){"use strict";t.exports=function(t,e){this.user=t,this.type="raser",this.seq=e.seq,this.show=!0,this.status=1,this.color=e.color,this.radius=e.radius,this.location={x:e.x,y:e.y}}},function(t,e,r){"use strict";t.exports=function(t,e){this.user=t,this.type="select",this.seq=Math.floor(100*Math.random()),this.show=!0,this.color=e.color,this.startInfo={x:e.startx,y:e.starty},this.location={x:e.x,y:e.y}}},function(t,e,r){"use strict";var i;function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var n=r(1),s=r(0);function a(){this.wxSysData=wx.getSystemInfoSync()}a.prototype={APIURL:"https://ilivelog.qcloud.com",events:{start_draw_curve:"start_draw_curve",move_draw_curve:"move_draw_curve",end_draw_curve:"end_draw_curve",over_draw_curve:"over_draw_curve",start_raser:"start_raser",end_raser:"end_raser",eraser:"eraser",move_scrawl:"move_scrawl",draw_graph:"draw_graph",clear_all:"clear_all",clear_scrawl:"clear_scrawl",set_bg_img:"set_bg_img",clear_bg_img:"clear_bg_img",set_bg_color:"set_bg_color",switch_board:"switch_board",start_select:"start_select",move_select:"move_select",end_select:"end_select",point_select:"point_select"},levels:{info:"info",warn:"warn",error:"error"},send:function(t){this.defDatas.brand=this.wxSysData.brand,this.defDatas.model=this.wxSysData.model,this.defDatas.platform=this.wxSysData.platform,this.defDatas.system=this.wxSysData.system,this.defDatas.weixinversion=this.wxSysData.version;try{t=this.fillDatas(t),wx.request({url:this.APIURL,data:JSON.stringify(t),method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){},fail:function(t){}})}catch(t){}},fillDatas:function(t){var e={};for(var r in this.defDatas)["sdkappid","classid","userid"].indexOf(r)>=0?e[r]=this.defDatas[r]:e[r]=void 0!==t[r]?t[r]:this.defDatas[r];return e},datasParseToString:function(t){var e=[];for(var r in t)e.push(r+"="+encodeURIComponent(t[r]));return e.join("&")},getXHR:function(){var t=null;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}if(null!=t)return t;console.log("Your browser does not support XMLHTTP.")},reporterHandel:function(){return function(t){t&&t.readyState&&t.readyState}},log:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.info})},warn:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.warn})},error:function(t,e){this.send({action:t,action_result:e||0,log_msg:t,log_level:this.levels.error})},defDatas:(i={action:"",version:s.VERSION,action_result:0,action_info:"",userid:"",time_consume:0,sdkappid:"",device:"miniprog",log_time:0,business:"ticsdk",roomid:"",boardid:"",image_url:"",boardid_list:[],to_boardId:"",color:null,file_id:"",file_title:"",isfinish:0,msgLength:20,bucket:"",cos_appid:null,extra_info:"",net_type:"unknown"},o(i,"net_type",null),o(i,"userAgent",null),o(i,"cookie",null),o(i,"brand",null),o(i,"model",null),o(i,"platform",null),o(i,"system",null),o(i,"weixinversion",null),i),setSdkAppid:function(t){void 0!=t&&null!=t?this.defDatas.sdkappid=t:console.log("sdkappid invalid!")},setRoomId:function(t){void 0!=t&&null!=t?this.defDatas.roomid=t:console.log("roomid invalid!")},setUserId:function(t){void 0!=t&&null!=t?this.defDatas.userid=t:console.log("userid invalid!")},boardAction:function(t,e){this.report(t,e)},report:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{this.send(Object.assign({action_result:0,time_consume:0},e,{action:t,log_time:n.getSecondTime()}))}catch(t){}}},t.exports=new a},function(t,e){t.exports=i;var r=null;try{r=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function i(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}function o(t){return!0===(t&&t.__isLong__)}i.prototype.__isLong__,Object.defineProperty(i.prototype,"__isLong__",{value:!0}),i.isLong=o;var n={},s={};function a(t,e){var r,i,o;return e?(o=0<=(t>>>=0)&&t<256)&&(i=s[t])?i:(r=l(t,(0|t)<0?-1:0,!0),o&&(s[t]=r),r):(o=-128<=(t|=0)&&t<128)&&(i=n[t])?i:(r=l(t,t<0?-1:0,!1),o&&(n[t]=r),r)}function d(t,e){if(isNaN(t))return e?m:y;if(e){if(t<0)return m;if(t>=f)return q}else{if(t<=-g)return T;if(t+1>=g)return B}return t<0?d(-t,e).neg():l(t%p|0,t/p|0,e)}function l(t,e,r){return new i(t,e,r)}i.fromInt=a,i.fromNumber=d,i.fromBits=l;var c=Math.pow;function u(t,e,r){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return y;if("number"==typeof e?(r=e,e=!1):e=!!e,(r=r||10)<2||36<r)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return u(t.substring(1),e,r).neg();for(var o=d(c(r,8)),n=y,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),l=parseInt(t.substring(s,s+a),r);if(a<8){var h=d(c(r,a));n=n.mul(h).add(d(l))}else n=(n=n.mul(o)).add(d(l))}return n.unsigned=e,n}function h(t,e){return"number"==typeof t?d(t,e):"string"==typeof t?u(t,e):l(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}i.fromString=u,i.fromValue=h;var p=4294967296,f=p*p,g=f/2,_=a(1<<24),y=a(0);i.ZERO=y;var m=a(0,!0);i.UZERO=m;var b=a(1);i.ONE=b;var v=a(1,!0);i.UONE=v;var D=a(-1);i.NEG_ONE=D;var B=l(-1,2147483647,!1);i.MAX_VALUE=B;var q=l(-1,-1,!0);i.MAX_UNSIGNED_VALUE=q;var T=l(0,-2147483648,!1);i.MIN_VALUE=T;var w=i.prototype;w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},w.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(T)){var e=d(t),r=this.div(e),i=r.mul(e).sub(this);return r.toString(t)+i.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var o=d(c(t,6),this.unsigned),n=this,s="";;){var a=n.div(o),l=(n.sub(a.mul(o)).toInt()>>>0).toString(t);if((n=a).isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},w.isZero=function(){return 0===this.high&&0===this.low},w.eqz=w.isZero,w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||this.high>=0},w.isOdd=function(){return 1==(1&this.low)},w.isEven=function(){return 0==(1&this.low)},w.equals=function(t){return o(t)||(t=h(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},w.eq=w.equals,w.notEquals=function(t){return!this.eq(t)},w.neq=w.notEquals,w.ne=w.notEquals,w.lessThan=function(t){return this.comp(t)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(t){return this.comp(t)<=0},w.lte=w.lessThanOrEqual,w.le=w.lessThanOrEqual,w.greaterThan=function(t){return this.comp(t)>0},w.gt=w.greaterThan,w.greaterThanOrEqual=function(t){return this.comp(t)>=0},w.gte=w.greaterThanOrEqual,w.ge=w.greaterThanOrEqual,w.compare=function(t){if(o(t)||(t=h(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(b)},w.neg=w.negate,w.add=function(t){o(t)||(t=h(t));var e=this.high>>>16,r=65535&this.high,i=this.low>>>16,n=65535&this.low,s=t.high>>>16,a=65535&t.high,d=t.low>>>16,c=0,u=0,p=0,f=0;return p+=(f+=n+(65535&t.low))>>>16,u+=(p+=i+d)>>>16,c+=(u+=r+a)>>>16,c+=e+s,l((p&=65535)<<16|(f&=65535),(c&=65535)<<16|(u&=65535),this.unsigned)},w.subtract=function(t){return o(t)||(t=h(t)),this.add(t.neg())},w.sub=w.subtract,w.multiply=function(t){if(this.isZero())return y;if(o(t)||(t=h(t)),r)return l(r.mul(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned);if(t.isZero())return y;if(this.eq(T))return t.isOdd()?T:y;if(t.eq(T))return this.isOdd()?T:y;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(_)&&t.lt(_))return d(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,i=65535&this.high,n=this.low>>>16,s=65535&this.low,a=t.high>>>16,c=65535&t.high,u=t.low>>>16,p=65535&t.low,f=0,g=0,m=0,b=0;return m+=(b+=s*p)>>>16,g+=(m+=n*p)>>>16,m&=65535,g+=(m+=s*u)>>>16,f+=(g+=i*p)>>>16,g&=65535,f+=(g+=n*u)>>>16,g&=65535,f+=(g+=s*c)>>>16,f+=e*p+i*u+n*c+s*a,l((m&=65535)<<16|(b&=65535),(f&=65535)<<16|(g&=65535),this.unsigned)},w.mul=w.multiply,w.divide=function(t){if(o(t)||(t=h(t)),t.isZero())throw Error("division by zero");var e,i,n;if(r)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?l((this.unsigned?r.div_u:r.div_s)(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?m:y;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return m;if(t.gt(this.shru(1)))return v;n=m}else{if(this.eq(T))return t.eq(b)||t.eq(D)?T:t.eq(T)?b:(e=this.shr(1).div(t).shl(1)).eq(y)?t.isNegative()?b:D:(i=this.sub(t.mul(e)),n=e.add(i.div(t)));else if(t.eq(T))return this.unsigned?m:y;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();n=y}for(i=this;i.gte(t);){e=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(e)/Math.LN2),a=s<=48?1:c(2,s-48),u=d(e),p=u.mul(t);p.isNegative()||p.gt(i);)p=(u=d(e-=a,this.unsigned)).mul(t);u.isZero()&&(u=b),n=n.add(u),i=i.sub(p)}return n},w.div=w.divide,w.modulo=function(t){return o(t)||(t=h(t)),r?l((this.unsigned?r.rem_u:r.rem_s)(this.low,this.high,t.low,t.high),r.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},w.mod=w.modulo,w.rem=w.modulo,w.not=function(){return l(~this.low,~this.high,this.unsigned)},w.and=function(t){return o(t)||(t=h(t)),l(this.low&t.low,this.high&t.high,this.unsigned)},w.or=function(t){return o(t)||(t=h(t)),l(this.low|t.low,this.high|t.high,this.unsigned)},w.xor=function(t){return o(t)||(t=h(t)),l(this.low^t.low,this.high^t.high,this.unsigned)},w.shiftLeft=function(t){return o(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?l(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):l(0,this.low<<t-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(t){return o(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?l(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):l(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(t){if(o(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?l(this.low>>>t|e<<32-t,e>>>t,this.unsigned):l(32===t?e:e>>>t-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.shr_u=w.shiftRightUnsigned,w.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},w.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},w.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},i.fromBytes=function(t,e,r){return r?i.fromBytesLE(t,e):i.fromBytesBE(t,e)},i.fromBytesLE=function(t,e){return new i(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},i.fromBytesBE=function(t,e){return new i(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}},,function(t,e,r){"use strict";r(8),r(7),r(6),r(10),r(9),r(4);var i=r(18),o=(r(0),r(3)),n=(r(2),r(1)),s=r(11);function a(t){this.option=Object.assign({},t),this.horizontal=this.option.horizontal||!0,this.conf_id=this.option.conf_id,this.canDraw=t.canDraw||!0,this.isMoving=!1,this.needDraw=!1,this.store=new i(t),this.store.setDefaultBoard(),this.img=t.img,this.width=this.option.width,this.height=this.option.height,this.canvasComponent=this.option.canvasComponent,this.context=this.option.context,this.init()}a.prototype.getEventLocation=function(t){var e={x:0,y:0};e.x=t.changedTouches[0].x,e.y=t.changedTouches[0].y,this.data.horizontal?(e.x=parseInt(e.x/this.data.width*1e4),e.y=parseInt(e.y/this.data.height*1e4)):(e.x=parseInt(e.x/this.data.height*1e4),e.y=parseInt(e.y/this.data.width*1e4))},a.prototype.draw=function(){var t=this,e=this.canvasComponent;e.clearRect(0,0,t.width,t.height);this.store.getTransparent();var r=this.store.getCurrentBoardData(),i=r.backgroundPic;i.url&&i.show?this.context.setCurrentImg(i.url):this.context.setCurrentImg(""),r.backgroundColor?this.context.setBoardBgColor(r.backgroundColor):this.context.setBoardBgColor(""),function(){var i=r.data;if((i=i.sort(function(t,e){return t.seq-e.seq})).forEach(function(r){if("line"==r.type&&r.show){var i=r.lines[0].x/1e4*t.width,s=r.lines[0].y/1e4*t.height;r.lines.forEach(function(o){e.beginPath(),e.moveTo(i,s),e.lineTo(o.x/1e4*t.width,o.y/1e4*t.height),e.setStrokeStyle(r.color),e.setLineWidth(r.thin/1e4*t.height),e.setLineCap("round"),e.stroke(),i=o.x/1e4*t.width,s=o.y/1e4*t.height})}else if("raser"==r.type&&r.status)e.beginPath(),e.arc(r.location.x/1e4*t.width,r.location.y/1e4*t.height,r.radius/1e4*t.height,0,2*Math.PI),e.setFillStyle(n.dealColor(o.COLOR.RED)),e.fill(),e.closePath();else if("select"==r.type&&r.show)e.setLineDash([15,5]),e.setLineWidth(1),e.setStrokeStyle(t.store.color),e.strokeRect(r.startInfo.x/1e4*t.width,r.startInfo.y/1e4*t.height,(r.location.x-r.startInfo.x)/1e4*t.width,(r.location.y-r.startInfo.y)/1e4*t.height),e.setLineDash([]);else if("graph"==r.type&&r.show)if("line"==r.graph)e.beginPath(),e.moveTo(r.startPoint.x/1e4*t.width,r.startPoint.y/1e4*t.height),e.lineTo(r.endPoint.x/1e4*t.width,r.endPoint.y/1e4*t.height),e.setStrokeStyle(r.color),e.setLineWidth(r.thin/1e4*t.height),e.setLineCap("round"),e.stroke();else if("rect"==r.graph){var a=r.startPoint.x>r.endPoint.x?r.endPoint.x:r.startPoint.x,d=r.startPoint.y>r.endPoint.y?r.endPoint.y:r.startPoint.y;e.setStrokeStyle(r.color),e.setLineWidth(r.thin/1e4*t.height),r.solid?(e.setFillStyle(r.color),e.fillRect(a/1e4*t.width,d/1e4*t.height,Math.abs(r.startPoint.x-r.endPoint.x)/1e4*t.width,Math.abs(r.startPoint.y-r.endPoint.y)/1e4*t.height)):e.strokeRect(a/1e4*t.width,d/1e4*t.height,Math.abs(r.startPoint.x-r.endPoint.x)/1e4*t.width,Math.abs(r.startPoint.y-r.endPoint.y)/1e4*t.height)}else if("circle"==r.graph||"oval"==r.graph){a=(r.startPoint.x+r.endPoint.x)/2/1e4*t.width,d=(r.startPoint.y+r.endPoint.y)/2/1e4*t.height;var l=Math.abs(r.startPoint.x-r.endPoint.x)/2/1e4*t.width,c=Math.abs(r.startPoint.y-r.endPoint.y)/2/1e4*t.height;e.setStrokeStyle(r.color),e.setLineWidth(r.thin/1e4*t.height),console.log(r.startPoint.x,r.endPoint.x,r.startPoint.y,r.endPoint.y,a,d,l,c),function(t,e,r,i,o,n,s){var a=.5522848,d=i*a,l=o*a;t.beginPath(),t.moveTo(e-i,r),t.bezierCurveTo(e-i,r-l,e-d,r-o,e,r-o),t.bezierCurveTo(e+d,r-o,e+i,r-l,e+i,r),t.bezierCurveTo(e+i,r+l,e+d,r+o,e,r+o),t.bezierCurveTo(e-d,r+o,e-i,r+l,e-i,r),t.closePath(),t.stroke(),n&&(t.setFillStyle(s),t.fill())}(e,a,d,l,c,r.solid,r.color),e.stroke()}}),t.isMoving){var s=t.store.getSelectArea(),a=t.store.getThin();e.setLineDash([15,5]),e.setLineWidth(1),e.strokeRect((s.x-a)/1e4*t.width,(s.y-a)/1e4*t.height,(s.width+2*a)/1e4*t.width,(s.height+2*a)/1e4*t.height),e.setLineDash([])}else{var d=this.store.getSelectList();d.forEach(function(r){if("line"==r.type)e.setLineDash([15,5]),e.setLineWidth(1),e.strokeRect((r.border.minX-2*r.thin)/1e4*t.width,(r.border.minY-2*r.thin)/1e4*t.height,(r.border.maxX-r.border.minX+4*r.thin)/1e4*t.width,(r.border.maxY-r.border.minY+4*r.thin)/1e4*t.height),e.setLineDash([]);else if("graph"==r.type){var i=r.endPoint.x,o=r.endPoint.y,n=r.startPoint.x,s=r.startPoint.y;e.setLineDash([15,5]),e.setLineWidth(1),e.strokeRect((n-2*r.thin)/1e4*t.width,(s-2*r.thin)/1e4*t.height,(i-n+4*r.thin)/1e4*t.width,(o-s+4*r.thin)/1e4*t.height),e.setLineDash([])}})}e.draw(!0)}.apply(this)},a.prototype.addBoard=function(){var t=this.store.createBoardId();this.store.addBoard(t)},a.prototype.getBoardData=function(){return JSON.parse(JSON.stringify(this.store.getData()))},a.prototype.addHistory=function(t){this.store.addHistory(t)},a.prototype.addData=function(t){this.store.addData(t)},a.prototype.deleteBoard=function(t){this.store.deleteBoard(t)},a.prototype.getBoardList=function(){return JSON.parse(JSON.stringify(this.store.getBoardList()))},a.prototype.getBoardPicList=function(){return JSON.parse(JSON.stringify(this.store.getBoardPicList()))},a.prototype.getCurrentBoard=function(){return this.store.currentBoard},a.prototype.switchBoard=function(t){return this.store.switchBoard(t)},a.prototype.prevBoard=function(){var t=this.getBoardList(),e=this.getCurrentBoard(),r=t.indexOf(e);r<1||this.switchBoard(t[r-1])},a.prototype.nextBoard=function(){var t=this.getBoardList(),e=this.getCurrentBoard(),r=t.indexOf(e);r<t.length-1&&this.switchBoard(t[r+1])},a.prototype.setGlobalBackgroundColor=function(t){this.store.setGlobalBackgroundColor(t)},a.prototype.setBackgroundColor=function(t){this.store.setBackgroundColor(t)},a.prototype.init=function(){var t=this;s.report("init"),this.draw(),this.drawInterval=setInterval(function(){t.store.getNeedDraw()&&(t.draw(),t.store.setNeedDraw(!1))},50)},a.prototype.setColor=function(t){this.store.setColor(t)},a.prototype.setThin=function(t){this.store.setThin(t)},a.prototype.setRadius=function(t){this.store.setRadius(t)},a.prototype.setType=function(t){this.store.setType(t)},a.prototype.undo=function(){this.store.undo()},a.prototype.canUndo=function(){return this.store.canUndo()},a.prototype.redo=function(){this.store.redo()},a.prototype.canRedo=function(){return this.store.canRedo()},a.prototype.clearBoard=function(t){this.store.clearBoard(t)},a.prototype.clear=function(){this.store.clear()},a.prototype.clearDraws=function(){this.store.clearDraws()},a.prototype.addBackgroundPic=function(t,e,r){this.store.addBackgroundPic(t,e,r)},a.prototype.setBackgroundPic=function(t){this.store.setBackgroundPic(t)},a.prototype.deleteBackgroundPic=function(t){this.store.deleteBackgroundPic(t)},a.prototype.cancelBackgroundPic=function(){this.store.cancelBackgroundPic()},a.prototype.clearGlobalBgColor=function(){this.store.clearGlobalBgColor()},a.prototype.cancelSelect=function(){this.store.cancelSelect()},a.prototype.setCanDraw=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.canDraw=t},a.prototype.addFile=function(t,e){return this.store.addFile(t,e)},a.prototype.deleteFile=function(t){return this.store.deleteFile(t)},a.prototype.switchFile=function(t){return this.store.switchFile(t)},a.prototype.getGroup=function(){return this.store.getGroup()},a.prototype.getBoardByGroup=function(t){return this.store.getBoardByGroup(t)},a.prototype.clearFileDraws=function(t){return this.store.clearFileDraws(t)},t.exports=a},,function(t,e,r){"use strict";var i=r(14),o=r(0),n=r(2);r(1),r(3);function s(t){this.board=new i(t),this.version=o.VERSION,console.log("当前白板版本：",this.version)}s.DRAW_TYPE={LINE:"line",ERASER:"eraser",RASER:"raser",POINTSELECT:"pointselect",SELECT:"select",GRAPH_LINE:"graph-line",GRAPH_CIRCLE:"graph-circle",GRAPH_RECT:"graph-rect",GRAPH_OVAL:"graph-oval",GRAPH_CIRCLE_SOLID:"graph-circle-solid",GRAPH_RECT_SOLID:"graph-rect-solid",GRAPH_OVAL_SOLID:"graph-oval-solid"},s.prototype.getBoardData=function(){return this.board.getBoardData()},s.prototype.getBoardPicList=function(){return this.board.getBoardPicList()},s.prototype.addData=function(t){this.board.addData(t)},s.prototype.addBoard=function(){this.board.switchBoard()},s.prototype.deleteBoard=function(t){this.board.deleteBoard(t)},s.prototype.prevBoard=function(){this.board.prevBoard()},s.prototype.nextBoard=function(){this.board.nextBoard()},s.prototype.getBoardList=function(){return this.board.getBoardList()},s.prototype.getCurrentBoard=function(){return JSON.parse(JSON.stringify(this.board.getCurrentBoard()))},s.prototype.switchBoard=function(t){t?this.board.switchBoard(t):console.error("boardId 不能为空")},s.prototype.setGlobalBackgroundColor=function(t){this.board.setGlobalBackgroundColor(t)},s.prototype.setBackgroundColor=function(t){this.board.setBackgroundColor(t)},s.prototype.setColor=function(t){this.board.setColor(t)},s.prototype.setThin=function(t){this.board.setThin(t)},s.prototype.setRadius=function(t){this.board.setRadius(t)},s.prototype.setType=function(t){this.board.setType(t)},s.prototype.undo=function(){this.board.undo()},s.prototype.canUndo=function(){return this.board.canUndo()},s.prototype.redo=function(){this.board.redo()},s.prototype.canRedo=function(){return this.board.canRedo()},s.prototype.clear=function(){this.board.clear()},s.prototype.clearDraws=function(){this.board.clearDraws()},s.prototype.setBackgroundPic=function(t){this.board.setBackgroundPic(t)},s.prototype.clearBackgroundPic=function(){this.board.cancelBackgroundPic()},s.prototype.clearGlobalBgColor=function(){this.board.clearGlobalBgColor()},s.prototype.cancelSelect=function(){this.board.cancelSelect()},s.prototype.on=function(t,e){n.on(t,e)},s.prototype.addFile=function(t,e){return this.board.addFile(t,e)},s.prototype.deleteFile=function(t){this.board.deleteFile(t)},s.prototype.switchFile=function(t){this.board.switchFile(t)},s.prototype.getFile=function(){return this.board.getGroup()},s.prototype.getBoardByFile=function(t){return this.board.getBoardByGroup(t)},s.prototype.setCanDraw=function(t){return this.board.setCanDraw(t)},s.prototype.getPreloadList=function(t){return this.board.getPreloadList(t)},s.prototype.clearFileDraws=function(t){this.board.clearFileDraws(t)},t.exports=s},,function(t,e,r){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=r(2),n=r(8),s=r(7),a=r(6),d=r(10),l=r(9),c=r(0),u=r(3),h=r(1),p=r(4),f=r(22),g=r(20),_=r(11);function y(t){this.options=JSON.parse(JSON.stringify(t)),this.preStep=t.preStep||2,this.context=t.context,this.maxSeq=0,this.request=new f(t),this.report=new g(this.request),this.syncHistroy=t.syncHistroy||!0,this.identifier=t.tlsData.identifier,this.conf_id=t.conf_id,this.user=t.tlsData.identifier,_.setSdkAppid(t.tlsData.sdkAppId),_.setRoomId(this.conf_id),_.setUserId(t.tlsData.identifier),this.data={},this.opData={},this.opIndex={},this.userData={},this.backgroundPic={},this.backgroundColor={},this.currentGroup=null,this.currentBoard=null,this.boardList=[],this.groups=[],this.color=0,this.thin=0,this.radius=0,this.globalBackgroundColor=0,this.type=null,this.transparent=!1,this.seq=0,this.selectedList=[],this.selectArea={},this.gSeq=0,this.boardIdSeq=0,this.belongLineSeq=0,this.realTimeData=[],this.beforeMoveType="",this.initInterval(),this.initData(t),this.syncHistroy&&this.conf_id&&this.syncHistroyData()}y.prototype.createBoardId=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentGroup;return 0==this.boardIdSeq?(this.boardIdSeq++,c.COMMON_DEFAULT_BOARD):c.PLATFORM+"_"+this.identifier+"_"+parseInt((new Date).getTime()/1e3)+"_"+this.boardIdSeq+++"_"+t},y.prototype.initInterval=function(){var t=this;this.sendInterval=setInterval(function(){t.realTimeData.length>0&&t.sendRequest()},200)},y.prototype.initData=function(t){this.setColor(t.color),this.setThin(t.thin),this.setRadius(t.radius),this.setType(t.type),this.setGlobalBackgroundColor(t.globalBackgroundColor,!0),this.setTransparent(t.transparent),this.setSelectArea()},y.prototype.addBoard=function(t){var e=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[];if(Array.isArray(t))i=t;else{if(!t)return;i=[t]}return i.forEach(function(t,r){e.userData[t]={},e.userData[t][e.identifier]=[],e.data[t]=[],e.opData[t]=[],e.opIndex[t]=0,e.backgroundColor[t]=e.globalBackgroundColor,e.backgroundPic[t]={url:"",user:e.identifier,show:!0},-1===e.boardList.indexOf(t)&&e.boardList.push(t)}),setTimeout(function(){o.fire(e,u.EVENT.ADD_BOARD,{current:e.currentBoard,list:e.boardList})},100),r&&this.report.reportCreateBoards(this.currentBoard,i),this.boardList},y.prototype.findLine=function(t,e,r){for(var i,o=this.userData[t][e],n=0,s=o.length;n<s;n++){var a=o[n];if("line"===a.type&&a.seq==r.belongSeq){i=a;break}}return i},y.prototype.setNeedDraw=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.needDraw=t},y.prototype.getNeedDraw=function(){return this.needDraw},y.prototype.getBoardList=function(){return this.boardList},y.prototype.getBoardPicList=function(){return this.backgroundPic},y.prototype.setDefaultBoard=function(){this.currentGroup=c.COMMON_GROUP,this.addGroup(c.COMMON_GROUP,c.COMMON_GROUP),this.currentBoard=this.createBoardId(),this.addBoard(this.currentBoard),this.setBackgroundColor(h.formatColor(this.globalBackgroundColor),!0),delete this.setDefaultBoard},y.prototype.removeBoard=function(t){if(1==this.boardList.length)return console.log("白板只有1页，无法删除"),[];Array.isArray(t)||(t=[t]);for(var e=[],r=!1,i=0,n=t.length;i<n;i++){var s,a=t[i];if((s=this.boardList.indexOf(a))>-1&&(e.push(a),delete this.userData[a],delete this.data[a],delete this.opData[a],delete this.opIndex[a],a==this.currentBoard)){this.boardList.splice(s,1);var d=0==s?s:s-1;this.currentBoard=this.boardList[d],r=!0}}return o.fire(this,u.EVENT.DELETE_BOARD,{current:this.currentBoard,list:this.boardList}),r&&this.fireSwitchBoardEvent(this.currentBoard,this.boardList),this.needDraw=!0,e},y.prototype.deleteBoard=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentBoard,e=arguments[1],r=this.removeBoard(t)||[];return r.length&&(this.realTimeData.push({action:c.PROTOCOL_ACTION.SWITCH_ACTION,time:h.getTimeStamp(),seq:p.getSeq(),toBoardId:this.currentBoard,deleteBoards:e?[]:r,deleteFiles:[e]}),this.report.reportDeleteBoard(r,this.currentBoard)),r},y.prototype.getGroup=function(){return this.groups},y.prototype.getBoardByGroup=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.COMMON_GROUP;return this.boardList.filter(function(e){return t===c.COMMON_GROUP&&e===c.COMMON_DEFAULT_BOARD||e.indexOf("_"+t)>-1})},y.prototype.addGroup=function(t,e){for(var r=!1,i=0,n=this.groups.length;i<n;i++){var s=this.groups[i];if(s.gid==s){r=!0;break}}return r?this.groups:(o.fire(this,u.EVENT.ADD_GROUP,t),t&&t!==c.COMMON_GROUP&&this.report.reportAddFile(t,e||t),this.groups.push({gid:t,title:e}))},y.prototype.deleteGroup=function(t){if(t===c.COMMON_GROUP)return console.error("不允许删除默认的白板分组"),!1;for(var e=-1,r=0,i=this.groups.length;r<i;r++){if(this.groups[r].gid==t){e=r;break}}return-1==e?(console.error("删除的分组不存在"),!1):(this.groups.splice(e,1),this.report.reportDeleteFile(t),this.getBoardByGroup(t))},y.prototype.setColor=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.COLOR.RED;this.cancelSelect(),"number"==typeof t?this.color=h.dealColor(t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length||(this.color=h.hexToRgba(t))},y.prototype.getColor=function(){return this.color},y.prototype.setThin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.THIN;this.cancelSelect(),this.thin=t},y.prototype.getThin=function(){return this.thin},y.prototype.setRadius=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.RADIUS;this.cancelSelect(),this.radius=t},y.prototype.setType=function(t){var e=Object.values(u.BOARD_ACTION_TYPE);"move"!=t&&this.cancelSelect(),e.indexOf(t)>-1?this.type=t:this.type=u.BOARD_ACTION_TYPE.LINE},y.prototype.getType=function(){return this.type},y.prototype.setTransparent=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.transparent=t},y.prototype.getTransparent=function(){return this.transparent},y.prototype.setBackgroundColor=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.COLOR.WHITE,e=arguments[1],r=this.currentBoard;"object"===(void 0===t?"undefined":i(t))&&(r=t.boardId,t=t.color);var o=0;"number"==typeof t?(this.backgroundColor[r]=h.dealColor(t),o=t):"string"!=typeof t||0!=t.indexOf("#")||4!==t.length&&7!==t.length||(this.backgroundColor[r]=h.hexToRgba(t),o=h.formatColor(h.hexToRgba(t))),this.needDraw=!0,e||(this.realTimeData.push({action:c.PROTOCOL_ACTION.UPDATE_BG_COLOR_ACTION,time:h.getTimeStamp(),seq:p.getSeq(),color:o,isGlobal:0}),this.report.reportSetBoardBgColor(r,o))},y.prototype.setSelectArea=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.selectArea={x:t,y:e,width:r,height:i}},y.prototype.getSelectArea=function(){return this.selectArea},y.prototype.getCurrentBoard=function(){return this.currentBoard},y.prototype.getData=function(){return this.data},y.prototype.getCurrentBoardData=function(){return{data:this.data[this.currentBoard],userData:this.userData[this.currentBoard],opData:this.opData[this.currentBoard],opIndex:this.opIndex[this.currentBoard],backgroundPic:this.backgroundPic[this.currentBoard],backgroundColor:this.backgroundColor[this.currentBoard]}},y.prototype.getCurrentBoardPic=function(){return this.backgroundPic[this.currentBoard]},y.prototype.getCurrentBoardColor=function(){return this.backgroundColor[this.currentBoard]},y.prototype.getSelectList=function(){return this.selectedList},y.prototype.clearBoard=function(t){this.currentBoard&&(this.data[this.currentBoard]=[],this.opData[this.currentBoard]=[],this.opIndex[this.currentBoard]=0,this.userData[this.currentBoard]={},this.userData[this.currentBoard][this.identifier]=[],t||(this.backgroundPic[this.currentBoard]={url:"",user:""},this.backgroundColor[this.currentBoard]=this.globalBackgroundColor),this.cancelSelect(),this.needDraw=!0)},y.prototype.clearFileDrawData=function(t){var e=this;t.forEach(function(t){(e.getBoardByGroup(t)||[]).forEach(function(t){e.data[t]=[],e.opData[t]=[],e.opIndex[t]=0,e.userData[t]={},e.userData[t][e.identifier]=[]})}),this.cancelSelect(),this.needDraw=!0},y.prototype.clear=function(){this.clearBoard(),this.realTimeData.push({action:101,seq:p.getSeq()}),this.report.reportClear(this.currentBoard)},y.prototype.clearDraws=function(){this.clearBoard(!0),this.realTimeData.push({action:102,seq:p.getSeq()}),this.report.reportClearDraws(this.currentBoard)},y.prototype.clearFileDraws=function(t){var e=this;if(t){Array.isArray(t)||(t=[t]),this.clearFileDrawData(t);var r=[];t.forEach(function(t){r=r.concat(e.getBoardByGroup(t))}),this.realTimeData.push({action:103,seq:p.getSeq(),fids:t}),this.report.reportClearDraws(r)}},y.prototype.addBackgroundPic=function(t,e){var r=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=[],n=[];if(Array.isArray(t)){if(!Array.isArray(e)||t.length!=e.length)return!1;o=t,n=e}else{if(Array.isArray(e))return!1;o=[t],n=[e]}var s=[];this.cancelSelect(),o.forEach(function(t,e){t===r.currentBoard&&i&&r.realTimeData.push({action:c.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:encodeURI(n[e]),time:h.getTimeStamp(),seq:p.getSeq(),mode:0,cleanBoard:0}),r.data[t]||r.addBoard(t),r.backgroundPic[t].url=decodeURI(n[e]),r.backgroundPic[t].show=!0,s.push({type:"image",seq:p.getSeq(),content:{boardId:t,url:encodeURI(n[e]),updateTime:h.getSecondTime(),mode:0}})}),i&&this.report.reportImages(s)},y.prototype.setBackgroundPic=function(t){this.cancelSelect(),this.addBackgroundPic(this.currentBoard,t,!1),this.realTimeData.push({action:c.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:t,time:h.getTimeStamp(),seq:p.getSeq(),mode:0,cleanBoard:0}),this.report.reportImage(this.currentBoard,t)},y.prototype.deleteBackgroundPic=function(t){this.cancelSelect(),this.backgroundPic[t].show=!1,this.needDraw=!0},y.prototype.cancelBackgroundPic=function(){this.cancelSelect(),this.deleteBackgroundPic(this.currentBoard),this.img.style.display="none",this.realTimeData.push({action:c.PROTOCOL_ACTION.DELETE_BG_IMG_ACTION,seq:this.getSeq()}),this.report.reportImage(this.currentBoard,"")},y.prototype.clearGlobalBgColor=function(){this.setGlobalBackgroundColor(this.options.globalBackgroundColor)},y.prototype.switchBoard=function(t){if(this.cancelSelect(),t&&!this.data[t])return console.error("没有这一页白板"),!1;t||(t=this.createBoardId(),this.addBoard(t)),this.currentBoard=t;var e=this.backgroundPic[this.currentBoard]?this.backgroundPic[this.currentBoard].url:"";e&&this.realTimeData.push({action:c.PROTOCOL_ACTION.UPDATE_BG_IMG_ACTION,url:e,time:h.getTimeStamp(),seq:p.getSeq(),mode:0,cleanBoard:0}),this.realTimeData.push({action:c.PROTOCOL_ACTION.SWITCH_ACTION,time:h.getTimeStamp(),seq:p.getSeq(),toBoardId:t,deleteBoards:[]}),this.sendRequest(),this.report.reportSwitchBoard(t),this.fireSwitchBoardEvent(this.currentBoard,this.boardList),this.needDraw=!0},y.prototype.setGlobalBackgroundColor=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.COLOR.WHITE,r=arguments[1],i=0;"number"==typeof e?(this.globalBackgroundColor=h.dealColor(e),i=e):"string"!=typeof e||0!=e.indexOf("#")||4!==e.length&&7!==e.length||(this.globalBackgroundColor=h.hexToRgba(e),i=h.formatColor(h.hexToRgba(e))),this.boardList.forEach(function(e){t.backgroundColor[e]=t.globalBackgroundColor}),this.needDraw=!0,r||(this.realTimeData.push({action:c.PROTOCOL_ACTION.UPDATE_BG_COLOR_ACTION,time:h.getTimeStamp(),seq:p.getSeq(),color:i,isGlobal:1}),this.report.reportGlobalBgColor(i))},y.prototype.resetOperation=function(){this.opData[this.currentBoard]=this.opData[this.currentBoard].slice(0,this.opIndex[this.currentBoard])},y.prototype.collectLineData=function(){var t=this;return{start:function(e,r){var i=p.getSeq();t.belongLineSeq=i;var o=new s(t.identifier,{color:t.color,thin:t.thin,x:e,y:r,show:!0,seq:i,belongSeq:i});t.userData[t.currentBoard][t.identifier].push(o),t.data[t.currentBoard].push(o),t.opData[t.currentBoard].push(new n(t.identifier,{seq:o.seq,type:t.type})),t.opIndex[t.currentBoard]++;var a={action:c.PROTOCOL_ACTION.LINE_START_ACTION,color:h.formatColor(o.color),scale:100,thin:o.thin,time:h.getTimeStamp(),seq:o.seq,belongSeq:o.belongSeq,x:e,y:r};t.realTimeData.push(a)},draw:function(e,r){var i=t.userData[t.currentBoard][t.identifier].length,o=t.userData[t.currentBoard][t.identifier][i-1];o.setBorder(e,r);var n=p.getSeq();o.lines.push({x:e,y:r,seq:n});var s={action:c.PROTOCOL_ACTION.LINE_MOVE_ACTION,seq:n,belongSeq:t.belongLineSeq,x:e,y:r};t.realTimeData.push(s)},end:function(e,r){var i=t.userData[t.currentBoard][t.identifier].length,o=t.userData[t.currentBoard][t.identifier][i-1];o.setBorder(e,r);var n=p.getSeq();o.lines.push({x:e,y:r,seq:n});var s={action:c.PROTOCOL_ACTION.LINE_END_ACTION,belongSeq:t.belongLineSeq,seq:n,x:e,y:r};t.realTimeData.push(s);var a=[];o.lines.forEach(function(t){a.push({seq:t.seq,x:t.x,y:t.y})}),t.report.reportAddLine({boardId:t.currentBoard,uid:t.identifier,colorRGBA:h.formatColor(t.color),scale:100,width:t.thin,time:o.time,updateTime:h.getSecondTime(),seq:o.seq,hidden:0,points:a})},over:function(){var e=t.userData[t.currentBoard][t.identifier].length,r=t.userData[t.currentBoard][t.identifier][e-1],i={action:c.PROTOCOL_ACTION.LINE_END_ACTION,belongSeq:t.belongLineSeq,seq:p.getSeq(),x:r.lines[r.lines.length-1].x,y:r.lines[r.lines.length-1].y};t.realTimeData.push(i)}}},y.prototype.collectEraserData=function(t,e){var r=this.eraserImpactCheck(t,e,this.radius);if(r.length>0){this.opData[this.currentBoard].push(new n("",{seq:r,type:this.type})),this.opIndex[this.currentBoard]++;var i={action:c.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:h.getTimeStamp(),seq:p.getSeq(),x:0,y:0,lines:r};r.length&&(this.realTimeData.push(i),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getSecondTime(),display:0,lines:r})),this.needDraw=!0}},y.prototype.collectRaserData=function(){var t=this;return{start:function(e,r){var i=new l(t.identifier,{color:h.dealColor(u.COLOR.RED),radius:t.thin,x:e,y:r,seq:p.getSeq()});t.seq=i.seq,t.userData[t.currentBoard][t.identifier].push(i),t.data[t.currentBoard].push(i);var o={action:c.PROTOCOL_ACTION.RASER_SHOW_ACTION,r:t.thin,seq:i.seq,x:e,y:r};t.realTimeData.push(o),t.needDraw=!0},draw:function(e,r){var i=t.userData[t.currentBoard][t.identifier].length;t.userData[t.currentBoard][t.identifier][i-1].location={x:e,y:r},t.needDraw=!0,t.realTimeData.push({action:c.PROTOCOL_ACTION.RASER_SHOW_ACTION,seq:p.getSeq(),x:e,y:r,r:t.thin})},end:function(e,r){var i=t.userData[t.currentBoard][t.identifier].length,o=t.userData[t.currentBoard][t.identifier][i-1];o.point={x:e,y:r},o.status=0;var n={action:c.PROTOCOL_ACTION.RASER_HIDE_ACTION,seq:o.seq};t.realTimeData.push(n),t.needDraw=!0},over:function(){var t=this.userData[this.currentBoard][this.identifier].length;this.userData[this.currentBoard][this.identifier][t-1].status=0,this.needDraw=!0}}},y.prototype.collectSelectData=function(){var t=this;return{start:function(e,r){t.beforeMoveType="select";var i=new d(t.identifier,{startx:e,starty:r,x:e,y:r});t.seq=i.seq,t.userData[t.currentBoard][t.identifier].push(i),t.data[t.currentBoard].push(i)},draw:function(e,r){var i=t.userData[t.currentBoard][t.identifier].length;t.userData[t.currentBoard][t.identifier][i-1].location={x:e,y:r},t.needDraw=!0},end:function(e,r,i,o){for(var n=e>i?e:i,s=r>o?r:o,a=e+i-n,d=r+o-s,l=t.data[t.currentBoard].length-1;l>=0;l--){var c=t.data[t.currentBoard][l];"line"==c.type&&c.show?n>=c.border.maxX&&s>=c.border.maxY&&a<=c.border.minX&&d<=c.border.minY&&(c.select=!0,t.selectedList.push(c)):"graph"==c.type&&c.show&&n>=c.endPoint.x&&s>=c.endPoint.y&&a<=c.startPoint.x&&d<=c.startPoint.y&&(c.select=!0,t.selectedList.push(c))}t.selectArea={x:a,y:d,width:n-a,height:s-d},t.userData[t.currentBoard][t.identifier][t.userData[t.currentBoard][t.identifier].length-1].show=!1,t.needDraw=!0,t.selectedList.length&&t.setType("move")}}},y.prototype.collectPointSelectData=function(t,e){this.beforeMoveType="pointselect";for(var r=!1,i=this.data[this.currentBoard].length-1;i>=0;i--){var o=this.data[this.currentBoard][i];if("line"==o.type&&o.show){if(t<o.border.maxX&&t>o.border.minX&&e<o.border.maxY&&e>o.border.minY){r=!0,o.select=!0,this.selectedList=[o],this.selectArea={x:o.border.minX,y:o.border.minY,width:o.border.maxX-o.border.minX,height:o.border.maxY-o.border.minY};break}}else if("graph"==o.type&&o.show){var n=o.endPoint.x,s=o.endPoint.y,a=o.startPoint.x,d=o.startPoint.y;if(n<a&&(n+=a,n-=a=n-a),s<d&&(s+=d,s-=d=s-d),s+=this.thin,n+=this.thin,a-=this.thin,d-=this.thin,t>=a&&t<=n&&e>=d&&e<=s){r=!0,o.select=!0,this.selectedList=[o],this.selectArea={x:a,y:d,width:n-a,height:s-d};break}}}r&&(this.needDraw=!0,this.setType("move"))},y.prototype.collectMoverData=function(){var t=this;return{beforeStart:function(e,r){if(0==t.selectedList.length)return!1;for(var i=!1,o=0;o<t.selectedList.length;o++){var n=t.selectedList[o];if("line"==n.type){if(n.border.minX<=e&&n.border.maxX>=e&&n.border.minY<=r&&n.border.maxY>=r){i=!0;break}}else if("graph"==n.type){var s=n.startPoint.x,a=n.endPoint.x,d=n.startPoint.y,l=n.endPoint.y;if(a<s&&(a+=s,a-=s=a-s),l<d&&(l+=d,l-=d=l-d),l+=t.thin,a+=t.thin,d-=t.thin,(s-=t.thin)<=e&&a>=e&&d<=r&&l>=r){i=!0;break}}}return!!i||(t.setType(t.beforeMoveType),t.cancelSelect(),t.needDraw=!0,!1)},start:function(e,r){var i=[];t.selectedList.forEach(function(t){"line"==t.type?i.push({uid:t.user,seq:t.seq,x:t.lines[0].x,y:t.lines[0].y}):"graph"==t.type&&i.push({uid:t.user,seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y})}),t.opData[t.currentBoard].push(new n("",{seq:{origin:i,final:[]},type:t.type}))},draw:function(e,r,i,o){if(t.selectedList.length>0){for(var n=0;n<t.selectedList.length;n++){var s=t.selectedList[n],a=e-i,d=r-o;"line"==s.type?(s.border.maxX+=a,s.border.minX+=a,s.border.maxY+=d,s.border.minY+=d,s.lines.forEach(function(t){t.x+=a,t.y+=d})):"graph"==s.type&&(s.startPoint.x+=a,s.startPoint.y+=d,s.endPoint.x+=a,s.endPoint.y+=d)}t.selectArea.x+=a,t.selectArea.y+=d,t.needDraw=!0}},end:function(){t.needDraw=!0;var e=[];if(0!=t.selectedList.length){t.selectedList.forEach(function(t){"line"==t.type?e.push({seq:t.seq,x:t.lines[0].x,y:t.lines[0].y,uid:t.user}):"graph"==t.type&&e.push({seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y,uid:t.user})});var r={action:c.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,seq:p.getSeq(),moves:e,time:h.getTimeStamp()};t.realTimeData.push(r);var i=[];t.selectedList.forEach(function(t){"line"==t.type?i.push({uid:t.user,seq:t.seq,x:t.lines[0].x,y:t.lines[0].y}):"graph"==t.type&&i.push({uid:t.user,seq:t.startPoint.seq,x:t.startPoint.x,y:t.startPoint.y})}),t.opData[t.currentBoard][t.opData[t.currentBoard].length-1].seq.final=i,t.opIndex[t.currentBoard]++;var o=[];e.forEach(function(e){for(var r=e.uid,i=0;i<t.userData[t.currentBoard][r].length;i++){var n=t.userData[t.currentBoard][r][i];if("line"==n.type&&e.seq==n.seq){var s=[];n.lines.forEach(function(t){s.push({seq:t.seq,x:t.x,y:t.y})}),o.push({type:"addLine",seq:p.getSeq(),content:{boardId:t.currentBoard,uid:n.user,colorRGBA:h.formatColor(n.color),scale:100,width:n.thin,time:n.time,updateTime:h.getSecondTime(),seq:n.seq,hidden:0,points:s}})}else if("graph"==n.type&&e.seq==n.startPoint.seq){var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[n.graph],seq:p.getSeq(),content:{boardId:t.currentBoard,uid:t.identifier,colorRGBA:h.formatColor(n.color),scale:100,width:n.thin,time:n.time,updateTime:h.getSecondTime(),hidden:0,beginPoint:{x:n.startPoint.x,y:n.startPoint.y,seq:n.startPoint.seq},endPoint:{x:n.endPoint.x,y:n.endPoint.y,seq:n.endPoint.seq}}};"oval"==n.graph||"circle"==n.graph?(a.content.fillRect=0,a.content.fillRect=n.solid?1:0):"rect"==n.graph&&(a.content.fillRect=0,a.content.fillRect=n.solid?1:0,a.content.cornerRadius=0),o.push(a)}}}),t.report.reportGraphData(o),t.setType(t.beforeMoveType)}}}},y.prototype.collectGraphData=function(){var t=this;return{start:function(e,r){var i=t.type.split("-")[1],o=new a(t.identifier,{graph:i,color:t.color,thin:t.thin,seq:p.getSeq(),beginPoint:{x:e,y:r,seq:p.getSeq()},endPoint:{x:e,y:r,seq:p.getSeq()},show:!0,solid:t.type.indexOf("solid")>-1});t.seq=o.seq,t.userData[t.currentBoard][t.identifier].push(o),t.data[t.currentBoard].push(o),t.opData[t.currentBoard].push(new n(t.identifier,{seq:o.startPoint.seq,type:"graph"})),t.opIndex[t.currentBoard]++},draw:function(e,r){var i=t.userData[t.currentBoard][t.identifier].length,o=t.userData[t.currentBoard][t.identifier][i-1];o.endPoint.x=e,o.endPoint.y=r,"circle"==o.graph&&circleFix(o),t.needDraw=!0},end:function(e,r){var i=t.userData[t.currentBoard][t.identifier].length,o=t.userData[t.currentBoard][t.identifier][i-1];o.endPoint.x=e,o.endPoint.y=r,"circle"==o.graph&&t.circleFix(o),"line"!=o.graph&&t.graphFix(o),t.needDraw=!0;var n={seq:o.seq,time:h.getTimeStamp(),color:h.formatColor(t.color),scale:100,thin:t.thin,beginPoint:{x:o.startPoint.x,y:o.startPoint.y,seq:o.startPoint.seq},endPoint:{x:o.endPoint.x,y:o.endPoint.y,seq:o.endPoint.seq}};n.action={line:10,oval:11,circle:11,rect:12}[o.graph];var s={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[o.graph],seq:p.getSeq(),content:{boardId:t.currentBoard,uid:t.identifier,colorRGBA:h.formatColor(t.color),scale:100,width:t.thin,time:o.time,updateTime:h.getSecondTime(),hidden:0,beginPoint:{x:o.startPoint.x,y:o.startPoint.y,seq:o.startPoint.seq},endPoint:{x:o.endPoint.x,y:o.endPoint.y,seq:o.endPoint.seq}}},a=t.type.indexOf("solid")>-1?1:0;n.action>10&&(n.fillRect=a,s.content.fillRect=a),12==n.action&&(n.cornerRadius=0,s.content.cornerRadius=0),t.realTimeData.push(n),t.report.reportGraphData([s])},over:function(t,e){this.end(t,e)}}},y.prototype.cancelSelect=function(){for(var t=0;t<this.selectedList.length;t++){this.selectedList[t].select=!1}this.selectedList=[],this.selectArea={x:0,y:0,width:0,height:0},this.needDraw=!0},y.prototype.eraserImpactCheck=function(t,e,r){var i=this,o=[];return this.data[this.currentBoard].forEach(function(n){if("line"==n.type&&n.show){var s=!1,a=n.border.maxX,d=n.border.maxY,l=n.border.minX,c=n.border.minY;if(a>=t&&d>=e&&l<=t&&c<=e)s=!0;else if(a>=t&&l<=t){(D=Math.min(Math.abs(d-e),Math.abs(c-e)))<=r&&(s=!0)}else if(d>=e&&c<=e){(D=Math.min(Math.abs(a-t),Math.abs(l-t)))<=r&&(s=!0)}else if(a<t){(D=d<e?Math.pow(t-a,2)+Math.pow(e-d,2):Math.pow(t-a,2)+Math.pow(e-c,2))<=Math.pow(r,2)&&(s=!0)}else{(D=d<e?Math.pow(t-l,2)+Math.pow(e-d,2):Math.pow(t-l,2)+Math.pow(e-c,2))<=Math.pow(r,2)&&(s=!0)}if(!s)return;s=!1;for(var u=1;u<n.lines.length;u++){var h=n.lines[u],p=n.lines[u-1];if((D=i.getDistance(t,e,h.x,h.y,p.x,p.y))<=(r+i.thin)*(r+i.thin)){s=!0;break}}s&&(n.show=!1,o.push({uid:n.user,seq:n.seq}))}else if("graph"==n.type&&n.show){if("line"==n.graph)(D=i.getDistance(t,e,n.startPoint.x,n.startPoint.y,n.endPoint.x,n.endPoint.y))<=(r+i.thin)*(r+i.thin)&&(n.show=!1,o.push({uid:n.user,seq:n.startPoint.seq}));else if("rect"==n.graph)if(n.solid)t>n.startPoint.x&&e>n.startPoint.y&&t<n.endPoint.x&&e<n.endPoint.y&&(n.show=!1,o.push({uid:n.user,seq:n.startPoint.seq}));else{var f=i.getDistance(t,e,n.startPoint.x,n.startPoint.y,n.startPoint.x,n.endPoint.y),g=i.getDistance(t,e,n.startPoint.x,n.startPoint.y,n.endPoint.x,n.startPoint.y),_=i.getDistance(t,e,n.endPoint.x,n.endPoint.y,n.startPoint.x,n.endPoint.y),y=i.getDistance(t,e,n.endPoint.x,n.endPoint.y,n.endPoint.x,n.startPoint.y);Math.min(f,g,_,y)<=(r+i.thin)*(r+i.thin)&&(n.show=!1,o.push({uid:n.user,seq:n.startPoint.seq}))}else if("circle"==n.graph){var m=(n.startPoint.x+n.endPoint.x)/2,b=(n.startPoint.y+n.endPoint.y)/2,v=Math.sqrt(Math.pow(n.startPoint.x-n.endPoint.x,2)+Math.pow(n.startPoint.y-n.endPoint.y,2))/2,D=Math.sqrt(Math.pow(t-m,2)+Math.pow(e-b,2));n.solid?D<v+r&&(n.show=!1,o.push({uid:n.user,seq:n.startPoint.seq})):Math.abs(v-D)<=r+i.thin&&(n.show=!1,o.push({uid:n.user,seq:n.startPoint.seq}))}else if("oval"==n.graph){m=(n.startPoint.x+n.endPoint.x)/2,b=(n.startPoint.y+n.endPoint.y)/2;var B=Math.abs(n.startPoint.x-n.endPoint.x)/2,q=Math.abs(n.startPoint.y-n.endPoint.y)/2;if(0==(D=Math.sqrt(Math.pow(t-m,2)+Math.pow(e-b,2))))n.solid?(n.show=!1,o.push({uid:n.user,seq:n.startPoint.seq})):(B<=r+i.thin||q<=r+i.thin)&&(n.show=!1,o.push({uid:n.user,seq:n.startPoint.seq}));else{var T=(e-b)/(t-m),w=Math.sqrt(1/(1/(B*B)+Math.pow(T/q,2))),P=Math.sqrt(1/(Math.pow(T/B,2)+1/(q*q))),x=t>m?m+w:m-w,I=e>b?b+P:b-P;if(n.solid){var O=Math.abs(t-m);w+r>O&&(n.show=!1,o.push({uid:n.user,seq:n.startPoint.seq}))}else(D=Math.pow(t-x,2)+Math.pow(e-I,2))<=(r+i.thin)*(r+i.thin)&&(n.show=!1,o.push({uid:n.user,seq:n.startPoint.seq}))}}}}),o},y.prototype.getDistance=function(t,e,r,i,o,n){var s={};if(r==o)s.x=r,s.y=e;else{var a=(i-n)/(r-o),d=i-a*r,l=t+a*e;s.x=(l-a*d)/(a*a+1),s.y=a*s.x+d}return s.x>=r&&s.x<=o||s.x<=r&&s.x>=o?(s.x-t)*(s.x-t)+(s.y-e)*(s.y-e):Math.min((r-t)*(r-t)+(i-e)*(i-e),(o-t)*(o-t)+(n-e)*(n-e))},y.prototype.circleFix=function(t){var e=Math.abs(t.startPoint.x-t.endPoint.x)*this.width/1e4,r=Math.abs(t.startPoint.y-t.endPoint.y)*this.height/1e4;e>r?t.endPoint.x=t.startPoint.x<t.endPoint.x?t.startPoint.x+1e4*r/this.width:t.startPoint.x-1e4*r/this.width:t.endPoint.y=t.startPoint.y<t.endPoint.y?t.startPoint.y+1e4*e/this.height:t.startPoint.y-1e4*e/this.height},y.prototype.graphFix=function(t){var e=t.startPoint.x,r=t.startPoint.y,i=t.endPoint.x,o=t.endPoint.y;t.startPoint={x:e>i?i:e,y:r>o?o:r,seq:t.startPoint.seq},t.endPoint={x:e>i?e:i,y:r>o?r:o,seq:t.endPoint.seq}},y.prototype.sendRequest=function(){var t=JSON.parse(JSON.stringify(this.realTimeData)),e={seq:p.getSeq(),timestamp:h.getTimeStamp(),value:{boardId:this.currentBoard,operator:this.identifier,actions:t}};this.realTimeData=[],o.fire(this,u.EVENT.RT_DATA,e)},y.prototype.sendRequestSpecial=function(t,e){var r={seq:p.getSeq(),timestamp:h.getTimeStamp(),value:{boardId:t,operator:this.identifier,actions:e}};o.fire(this,u.EVENT.RT_DATA,r)},y.prototype.addHistory=function(t){var e=this;this.sortBoard(),console.log(t),t.forEach(function(t){var r,i;if(t.content=JSON.parse(t.content),"setGlobalBG"===t.type);else if("createBoards"===t.type)t.content&&t.content.createBoards.forEach(function(t){r=t,e.userData[r]||e.addBoard(r,!1)});else if("addFile"===t.type){console.log("======== addFile");for(var o=t.content.fid,n=t.content.title,d=!1,l=0,c=e.groups.length;l<c;l++){var u=e.groups[l];if(u.gid==u){d=!0;break}}d||e.groups.push({gid:o,title:n})}else r=t.content.boardId,i=t.content.uid,e.userData[r]||e.addBoard(r,!1),e.userData[r][i]||(e.userData[r][i]=[]);if(t.content.colorRGBA&&(t.content.color=h.dealColor(t.content.colorRGBA)),t.content.width&&(t.content.thin=t.content.width),"addLine"==t.type){var p;for(l=0;l<t.content.points.length-1;l++){var f=t.content.points[l].x,g=t.content.points[l].y,y=t.content.points[0].seq;0==l?p=new s(i,{color:t.content.color,thin:t.content.thin,x:f,y:g,seq:t.content.points[l].seq,belongSeq:y,show:!t.content.hidden}):(p.lines.push({x:f,y:g,belongSeq:y,seq:t.content.points[l].seq}),p.sort(),l==t.content.points.length-1&&(p.endSeq=t.content.points[l].seq)),p.setBorder(f,g)}p&&(e.userData[r][i].push(p),e.data[r].push(p))}else if("displayLine"==t.type){t.content.lines.forEach(function(r){for(var o=0;o<e.userData[e.currentBoard][i].length;o++){var n=e.userData[e.currentBoard][i][o];"line"==n.type&&n.startSeq==r.seq?n.show=!!t.content.display:"graph"==n.type&&n.startPoint.seq==r.seq&&(n.show=!!t.content.display)}})}else if("addPatternLine"==t.type||"addPatternCircle"==t.type||"addPatternRectangle"==t.type){t.content.graph={addPatternLine:"line",addPatternCircle:"oval",addPatternRectangle:"rect"}[t.type],t.content.beginPoint.x=t.content.beginPoint.x,t.content.endPoint.x=t.content.endPoint.x,t.content.beginPoint.y=t.content.beginPoint.y,t.content.endPoint.y=t.content.endPoint.y,t.content.seq=t.content.beginPoint.seq,t.content.show=!t.content.hidden,t.content.solid=!!t.content.fillRect;var m=new a(i,t.content);e.userData[r][i].push(m),e.data[r].push(m)}else"image"==t.type?t.content.url?e.addBackgroundPic(t.content.boardId,t.content.url,!1,!1):e.deleteBackgroundPic(t.content.boardId):"clean"==t.type?e.clearBoard(!1):"cleanDraws"==t.type?e.clearBoard(!0):"switchBoard"==t.type?(1*t.seq||0)>e.maxSeq?(e.maxSeq=t.seq,e.data[r]||e.addBoard(r,!1),e.currentBoard=r,e.fireSwitchBoardEvent(r,e.boardList)):_.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxSeq:e.maxSeq,boardId:r,method:"addHistory"})}):"setBoardBG"==t.type?e.setBackgroundColor({boardId:r,color:t.content.colorRGBA},!0):"setGlobalBG"==t.type&&e.setGlobalBackgroundColor(t.content.colorRGBA,!0)}),e.needDraw=!0},y.prototype.undo=function(){var t=this;this.cancelSelect();var e=this.opData[this.currentBoard][this.opIndex[this.currentBoard]-1];if(e){if("line"==e.type)for(var r=0;r<this.userData[this.currentBoard][e.user].length;r++){var i=this.userData[this.currentBoard][e.user][r];if(e.seq==i.seq){i.show=!1,this.realTimeData.push({action:c.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:h.getTimeStamp(),seq:p.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getSecondTime(),display:0,lines:[{uid:e.user,seq:e.seq}]});break}}else if("eraser"==e.type)e.seq.forEach(function(e){for(var r=e.uid,i=0;i<t.userData[t.currentBoard][r].length;i++){var o=t.userData[t.currentBoard][r][i];"line"==o.type&&e.seq==o.seq?o.show=!0:"graph"==o.type&&e.seq==o.startPoint.seq&&(o.show=!0)}}),this.realTimeData.push({action:c.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:h.getTimeStamp(),seq:p.getSeq(),lines:e.seq}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getSecondTime(),display:1,lines:e.seq});else if("graph"==e.type)for(r=0;r<this.userData[this.currentBoard][e.user].length;r++){if("graph"==(i=this.userData[this.currentBoard][e.user][r]).type&&e.seq==i.startPoint.seq){i.show=!1,this.realTimeData.push({action:c.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:h.getTimeStamp(),seq:p.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getSecondTime(),display:0,lines:[{uid:e.user,seq:e.seq}]});break}}else if("move"==e.type){var o=[];e.seq.origin.forEach(function(e){for(var r=e.uid,i=0;i<t.userData[t.currentBoard][r].length;i++){var n=t.userData[t.currentBoard][r][i];if("line"==n.type&&e.seq==n.seq){var s=e.x-n.lines[0].x,a=e.y-n.lines[0].y;n.border.maxX+=s,n.border.minX+=s,n.border.maxY+=a,n.border.minY+=a,n.lines.forEach(function(t){t.x+=s,t.y+=a}),o.push({uid:r,seq:e.seq,x:e.x,y:e.y})}else if("graph"==n.type&&e.seq==n.startPoint.seq){s=e.x-n.startPoint.x,a=e.y-n.startPoint.y;n.startPoint.x+=s,n.startPoint.y+=a,n.endPoint.x+=s,n.endPoint.y+=a,o.push({uid:r,seq:e.seq,x:e.x,y:e.y})}}}),this.realTimeData.push({action:c.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,time:h.getTimeStamp(),seq:p.getSeq(),moves:o});var n=[];e.seq.origin.forEach(function(e){for(var r=e.uid,i=0;i<t.userData[t.currentBoard][r].length;i++){var o=t.userData[t.currentBoard][r][i];if("line"==o.type&&e.seq==o.seq){var s=[];o.lines.forEach(function(t){s.push({seq:t.seq,x:t.x,y:t.y})}),n.push({type:"addLine",seq:p.getSeq(),content:{boardId:t.currentBoard,uid:o.user,colorRGBA:h.formatColor(o.color),scale:100,width:o.thin,time:o.time,updateTime:h.getSecondTime(),seq:o.seq,hidden:0,points:s}})}else if("graph"==o.type&&e.seq==o.startPoint.seq){var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[o.graph],seq:p.getSeq(),content:{boardId:t.currentBoard,uid:t.identifier,colorRGBA:h.formatColor(o.color),scale:100,width:o.thin,time:o.time,updateTime:h.getSecondTime(),hidden:0,beginPoint:{x:o.startPoint.x,y:o.startPoint.y,seq:o.startPoint.seq},endPoint:{x:o.endPoint.x,y:o.endPoint.y,seq:o.endPoint.seq}}};"oval"==o.graph||"circle"==o.graph?a.content.fillRect=0:"rect"==o.graph&&(a.content.fillRect=0,a.content.cornerRadius=0),n.push(a)}}}),this.report.reportGraphData(n)}this.opIndex[this.currentBoard]--,this.needDraw=!0}},y.prototype.canUndo=function(){return 0!=this.opIndex[this.currentBoard]},y.prototype.redo=function(){var t=this;this.cancelSelect();var e=this.opData[this.currentBoard][this.opIndex[this.currentBoard]];if(e){if("line"==e.type)for(var r=0;r<this.userData[this.currentBoard][e.user].length;r++){var i=this.userData[this.currentBoard][e.user][r];if(e.seq==i.seq){i.show=!0,this.realTimeData.push({action:c.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:h.getTimeStamp(),seq:p.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getSecondTime(),display:1,lines:[{uid:e.user,seq:e.seq}]});break}}else if("eraser"==e.type)e.seq.forEach(function(e){for(var r=e.uid,i=0;i<t.userData[t.currentBoard][r].length;i++){var o=t.userData[t.currentBoard][r][i];"line"==o.type&&e.seq==o.seq?o.show=!1:"graph"==o.type&&e.seq==o.startPoint.seq&&(o.show=!1)}}),this.realTimeData.push({action:c.PROTOCOL_ACTION.ERASER_ACTION,display:0,time:h.getTimeStamp(),seq:p.getSeq(),lines:e.seq}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getSecondTime(),display:0,lines:e.seq});else if("graph"==e.type)for(r=0;r<this.userData[this.currentBoard][e.user].length;r++){if("graph"==(i=this.userData[this.currentBoard][e.user][r]).type&&e.seq==i.startPoint.seq){i.show=!0,this.realTimeData.push({action:c.PROTOCOL_ACTION.ERASER_ACTION,display:1,time:h.getTimeStamp(),seq:p.getSeq(),lines:[{uid:e.user,seq:e.seq}]}),this.report.reportDisplayLine({boardId:this.currentBoard,updateTime:h.getSecondTime(),display:1,lines:[{uid:e.user,seq:e.seq}]});break}}else if("move"==e.type){var o=[];e.seq.final.forEach(function(e){for(var r=e.uid,i=0;i<t.userData[t.currentBoard][r].length;i++){var n=t.userData[t.currentBoard][r][i];if("line"==n.type&&e.seq==n.seq){var s=e.x-n.lines[0].x,a=e.y-n.lines[0].y;n.border.maxX+=s,n.border.minX+=s,n.border.maxY+=a,n.border.minY+=a,n.lines.forEach(function(t){t.x+=s,t.y+=a}),o.push({uid:r,seq:e.seq,x:e.x,y:e.y})}else if("graph"==n.type&&e.seq==n.startPoint.seq){s=e.x-n.startPoint.x,a=e.y-n.startPoint.y;n.startPoint.x+=s,n.startPoint.y+=a,n.endPoint.x+=s,n.endPoint.y+=a,o.push({uid:r,seq:e.seq,x:e.x,y:e.y})}}}),this.realTimeData.push({action:c.PROTOCOL_ACTION.MOVE_LINE_GRAPH_ACTION,time:h.getTimeStamp(),seq:p.getSeq(),moves:o});var n=[];e.seq.final.forEach(function(e){for(var r=e.uid,i=0;i<t.userData[t.currentBoard][r].length;i++){var o=t.userData[t.currentBoard][r][i];if("line"==o.type&&e.seq==o.seq){var s=[];o.lines.forEach(function(t){s.push({seq:t.seq,x:t.x,y:t.y})}),n.push({type:"addLine",seq:p.getSeq(),content:{boardId:t.currentBoard,uid:o.user,colorRGBA:h.formatColor(o.color),scale:100,width:o.thin,time:o.time,updateTime:h.getSecondTime(),seq:o.seq,hidden:0,points:s}})}else if("graph"==o.type&&e.seq==o.startPoint.seq){var a={type:{line:"addPatternLine",oval:"addPatternCircle",circle:"addPatternCircle",rect:"addPatternRectangle"}[o.graph],seq:p.getSeq(),content:{boardId:t.currentBoard,uid:t.identifier,colorRGBA:h.formatColor(o.color),scale:100,width:o.thin,time:o.time,updateTime:h.getSecondTime(),hidden:0,beginPoint:{x:o.startPoint.x,y:o.startPoint.y,seq:o.startPoint.seq},endPoint:{x:o.endPoint.x,y:o.endPoint.y,seq:o.endPoint.seq}}};"oval"==o.graph||"circle"==o.graph?a.content.fillRect=0:"rect"==o.graph&&(a.content.fillRect=0,a.content.cornerRadius=0),n.push(a)}}}),this.report.reportGraphData(n)}this.opIndex[this.currentBoard]++,this.needDraw=!0}},y.prototype.canRedo=function(){return this.opIndex[this.currentBoard]!=this.opData[this.currentBoard].length},y.prototype.syncHistroyData=function(){var t=this,e=this;e.clearBoard();var r=[],i=[],n=0;return new Promise(function(s,a){!function e(o,s){var a=(new Date).getTime();new Promise(function(e,r){t.request.getBoardData(function(t){t.error_code?(_.report("getBoardData",{action_result:t.error_code,action_info:t.error_msg,time_consume:(new Date).getTime()-a,extra_info:JSON.stringify(t)}),r("error_code:"+t.error_code+" error_msg:"+t.error_msg)):(_.report("getBoardData",{time_consume:(new Date).getTime()-a,extra_info:JSON.stringify(t)}),e(t))},function(t){r("error_code:"+t+" error_msg:HTTP请求错误，请重试")})}).then(function(t){(t.board_data_list||[]).forEach(function(t){"setGlobalBG"===t.type?r.push(t):i.push(t)}),n++,!t.is_finish&&n<500?e(o,s):o()}).catch(function(t){console.error("恢复课堂：",t)})}(function(){e.addHistory(r),e.addHistory(i),e.sortBoard(),e.syncBoardSeq(),o.fire(this,u.EVENT.HISTROY_DATA_COMPLETE)})})},y.prototype.sortBoard=function(){this.boardList=this.boardList.sort(function(t,e){return(t===c.COMMON_DEFAULT_BOARD?0:t.match(/\d+_#\w+$/)[0].split("_")[0])-(e===c.COMMON_DEFAULT_BOARD?0:e.match(/\d+_#\w+$/)[0].split("_")[0])})},y.prototype.syncBoardSeq=function(){1==this.boardList.length&&this.boardList[0]===c.COMMON_DEFAULT_BOARD?this.boardIdSeq=1:this.boardList[this.boardList.length-1]&&(this.boardIdSeq=this.boardList[this.boardList.length-1].match(/\d+_#\w+$/)[0].split("_")[0]+1)},y.prototype.syncGroup=function(){var t=this,e={};this.boardList.forEach(function(t){if(t!==c.COMMON_DEFAULT_BOARD){var r=t.match(/\d+_#\w+$/)[0].split("_")[1];e[r]=!0}}),Object.keys(e).forEach(function(e){t.addGroup(e,!1)})},y.prototype.addData=function(t){var e=this;_.report("addData",{extra_info:JSON.stringify(t)});var r=t.value.operator,i=t.value.actions,o=t.value.boardId;this.userData[o]||this.addBoard(o,!1),this.userData[o][r]||(this.userData[o][r]=[]);this.userData[o][r].length;i.forEach(function(t){if(t.color&&(t.color=h.dealColor(t.color)),1==t.action)(i=e.findLine(o,r,t))?(i.color=t.color,i.thin=t.thin,i.show=!0,i.lines.push({x:t.x,y:t.y,belongSeq:t.belongSeq,seq:t.seq}),i.sort(),i.setBorder(t.x,t.y)):((i=new s(r,t)).show=!0,e.userData[o][r].push(i),e.data[o].push(i));else if(2==t.action||3==t.action){var i;(i=e.findLine(o,r,t))?(i.lines.push({x:t.x,y:t.y,belongSeq:t.belongSeq,seq:t.seq}),i.sort(),i.setBorder(t.x,t.y)):(i=new s(r,t),e.userData[o][r].push(i),e.data[o].push(i)),3==t.action&&(i.endSeq=t.seq,function(t,r){setTimeout(function(){t.color&&t.thin||e.request.getLineData({boardId:r,owner:t.user,seq:t.belongSeq},function(t){t.error_code||(e.addHistory([{content:t.content,type:t.type}]),e.sortBoard(),e.syncBoardSeq())})},500)}(i,o))}else if(6==t.action){e.userData[o][r].forEach(function(t){"raser"==t.type&&(t.status=0)});var n=new l(e.identifier,{color:t.color,radius:e.thin,x:t.x,y:t.y,seq:p.getSeq()});e.userData[o][r].push(n),e.data[o].push(n)}else if(7==t.action)e.userData[o][r].forEach(function(t){"raser"==t.type&&(t.status=0)});else if(8==t.action){if(!t.lines)return;t.lines.forEach(function(r){for(var i=0;i<e.userData[o][r.uid].length;i++){var n=e.userData[o][r.uid][i];"line"==n.type&&n.startSeq==r.seq?n.show=!!t.display:"graph"==n.type&&n.startPoint.seq==r.seq&&(n.show=!!t.display)}})}else if(9==t.action){if(!t.moves)return;t.moves.forEach(function(t){t.x=t.x,t.y=t.y;for(var r=0;r<e.userData[o][t.uid].length;r++){var i=e.userData[o][t.uid][r];if("line"==i.type&&i.startSeq==t.seq){var n=t.x-i.lines[0].x,s=t.y-i.lines[0].y;i.border.maxX+=n,i.border.minX+=n,i.border.maxY+=s,i.border.minY+=s,i.lines.forEach(function(t){t.x+=n,t.y+=s})}else if("graph"==i.type&&i.startPoint.seq==t.seq){n=t.x-i.startPoint.x,s=t.y-i.startPoint.y;i.startPoint.x+=n,i.startPoint.y+=s,i.endPoint.x+=n,i.endPoint.y+=s}}})}else if(10==t.action||11==t.action||12==t.action){t.graph={10:"line",11:"oval",12:"rect"}[t.action],t.beginPoint.x=t.beginPoint.x,t.endPoint.x=t.endPoint.x,t.beginPoint.y=t.beginPoint.y,t.endPoint.y=t.endPoint.y,t.solid=!!t.fillRect,t.show=!0;var d=new a(r,t);e.userData[o][r].push(d),e.data[o].push(d),0}else if(101==t.action)e.clearBoard(!1);else if(102==t.action)e.clearBoard(!0);else if(103==t.action)try{e.clearFileDrawData(t.fids)}catch(t){}else if(201==t.action)e.addBackgroundPic(o,t.url,!1);else if(202==t.action)e.deleteBackgroundPic(o);else if(203==t.action)t.color&&(t.color=h.formatColor(t.color)),t.isGlobal?e.setGlobalBackgroundColor(t.color,!0):e.setBackgroundColor(t.color,!0);else if(401==t.action){var c=t.toBoardId;if((1*t.seq||0)>e.maxSeq){e.maxSeq=t.seq;var u=t.deleteFiles||[],f=t.deleteBoards||[];u.forEach(function(t){f.contact(e.getBoardByGroup(t))}),f.forEach(function(t){e.removeBoard(t)}),e.data[c]||e.addBoard(c,!1),e.currentBoard=c,e.fireSwitchBoardEvent(e.currentBoard,e.boardList)}else _.report("throw_seq",{extra_info:JSON.stringify({seq:t.seq,maxSeq:self.maxSeq,boardId:c,method:"addData"})})}}),this.needDraw=!0},y.prototype.addFile=function(t,e){var r=this;if(Array.isArray(t)){var i="#"+h.getTimeStamp(),o=[];return t.forEach(function(){o.push(r.createBoardId(i))}),this.addGroup(i,e),this.addBoard(o),this.addBackgroundPic(o,t),setTimeout(function(){o.length&&r.switchBoard(o[0])},200),i}},y.prototype.deleteFile=function(t){var e=this.deleteGroup(t);return o.fire(this,u.EVENT.DELETE_GROUP,t),!!e&&(this.deleteBoard(e),!0)},y.prototype.switchFile=function(t){for(var e=!1,r=0,i=this.groups.length;r<i;r++){var n=this.groups[r];if(n.gid==n){e=!0;break}}return e?(this.currentGroup=t,o.fire(this,u.EVENT.SWITCH_GROUP,t),t):(console.log("不存在该白板组"),!1)},y.prototype.getPreloadList=function(){var t=this.getBoardList(),e=t.indexOf(this.getCurrentBoard()),r="",i=0,o=this.getBoardPicList();t.forEach(function(t){i++});for(var n=new Array,s=e-this.preStep;s<=e+this.preStep;s++)s!=e&&s>0&&s<i&&""!=(r=o[t[s]].url)&&n.push(r);return n},y.prototype.fireSwitchBoardEvent=function(t,e){var r=this;o.fire(this,u.EVENT.SWITCH_BOARD,{current:t,list:e}),setTimeout(function(){r.context.setPreLoadImgList(r.getPreloadList())},10)},t.exports=y},,function(t,e,r){"use strict";function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var o=r(4),n=r(1),s=r(11);function a(t){this.request=t}a.prototype.reportCreateBoards=function(t,e){var r=[];r=Array.isArray(e)?e:[e];var i=(new Date).getTime();this.request.reportMsg([{type:"createBoards",seq:o.getSeq(),content:{createBoards:r,updateTime:n.getSecondTime()}}],function(e){e.ErrorCode||e.error_code?s.boardAction("createBoards",{action_result:e.ErrorCode?"ErrorCode:"+e.ErrorCode:"error_code:"+e.error_code,action_info:e.ErrorInfo||e.error_msg,time_consume:n.getTimeDiff(i),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):s.boardAction("createBoards",{action_result:0,action_info:null,time_consume:n.getTimeDiff(i),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(e){s.boardAction("createBoards",{action_result:-9999,action_info:e&&e.message,time_consume:n.getTimeDiff(i),boardid:t,boardid_list:r,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},a.prototype.reportDeleteBoard=function(t,e){var r=(new Date).getTime();this.request.reportMsg([{type:"deleteBoards",seq:o.getSeq(),content:{deleteBoards:t,toBoardId:e,updateTime:n.getSecondTime()}}],function(i){i.ErrorCode||i.error_code?s.boardAction("deleteBoards",{action_result:i.ErrorCode?"ErrorCode:"+i.ErrorCode:"error_code:"+i.error_code,action_info:i.ErrorInfo||i.error_msg,time_consume:n.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null}):s.boardAction("deleteBoards",{action_result:0,action_info:null,time_consume:n.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})},function(i){s.boardAction("deleteBoards",{action_result:-9999,action_info:i&&i.message,time_consume:n.getTimeDiff(r),boardid:null,boardid_list:t,image_url:null,to_boardId:e,color:null,file_id:null,file_title:null})})},a.prototype.reportSetBoardBgColor=function(t,e){var r=(new Date).getTime();this.request.reportMsg([{type:"setBoardBG",seq:o.getSeq(),content:{boardId:t,updateTime:n.getSecondTime(),colorRGBA:e}}],function(i){i.ErrorCode||i.error_code?s.boardAction("setBoardBG",{action_result:i.ErrorCode?"ErrorCode:"+i.ErrorCode:"error_code:"+i.error_code,action_info:i.ErrorInfo||i.error_msg,time_consume:n.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null}):s.boardAction("setBoardBG",{action_result:0,action_info:null,time_consume:n.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})},function(i){s.boardAction("setBoardBG",{action_result:-9999,action_info:i&&i.message,time_consume:n.getTimeDiff(r),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:e,file_id:null,file_title:null})})},a.prototype.reportClear=function(t){var e=(new Date).getTime();this.request.reportMsg([{type:"clean",seq:o.getSeq(),content:{boardId:t,updateTime:n.getSecondTime()}}],function(r){r.ErrorCode||r.error_code?s.boardAction("clean",{action_result:r.ErrorCode?"ErrorCode:"+r.ErrorCode:"error_code:"+r.error_code,action_info:r.ErrorInfo||r.error_msg,time_consume:n.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):s.boardAction("clean",{action_result:0,action_info:null,time_consume:n.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){s.boardAction("clean",{action_result:-9999,action_info:r&&r.message,time_consume:n.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},a.prototype.reportClearDraws=function(t){var e=(new Date).getTime();this.request.reportMsg([{type:"cleanDraws",seq:o.getSeq(),content:{boardId:t,updateTime:n.getSecondTime()}}],function(r){r.ErrorCode||r.error_code?s.boardAction("cleanDraws",{action_result:r.ErrorCode?"ErrorCode:"+r.ErrorCode:"error_code:"+r.error_code,action_info:r.ErrorInfo||r.error_msg,time_consume:n.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):s.boardAction("cleanDraws",{action_result:0,action_info:null,time_consume:n.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){s.boardAction("cleanDraws",{action_result:-9999,action_info:r&&r.message,time_consume:n.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},a.prototype.reportImage=function(t,e){var r=(new Date).getTime();this.request.reportMsg([{type:"image",seq:o.getSeq(),content:{boardId:t,url:e,updateTime:n.getSecondTime(),mode:0}}],function(o){var a,d,l={};(l[t]=e,o.ErrorCode||o.error_code)?s.boardAction("image",(i(a={action_result:o.ErrorCode?"ErrorCode:"+o.ErrorCode:"error_code:"+o.error_code,action_info:o.ErrorInfo||o.error_msg,time_consume:n.getTimeDiff(r),boardid:null,boardid_list:null},"boardid_list",[l]),i(a,"to_boardId",null),i(a,"color",null),i(a,"file_id",null),i(a,"file_title",null),a)):s.boardAction("image",(i(d={action_result:0,action_info:null,time_consume:n.getTimeDiff(r),boardid:null,boardid_list:null},"boardid_list",[l]),i(d,"to_boardId",null),i(d,"color",null),i(d,"file_id",null),i(d,"file_title",null),d))},function(t){var e;s.boardAction("image",(i(e={action_result:-9999,action_info:t&&t.message,time_consume:n.getTimeDiff(r),boardid:null,boardid_list:null},"boardid_list",[boardInfo]),i(e,"to_boardId",null),i(e,"color",null),i(e,"file_id",null),i(e,"file_title",null),e))})},a.prototype.reportImages=function(t){var e=(new Date).getTime();this.request.reportMsg(t,function(r){var o,a,d=[];(t.forEach(function(t){var e={};e[t.content.boardId]=t.content.url,d.push(e)}),r.ErrorCode||r.error_code)?s.boardAction("image",(i(o={action_result:r.ErrorCode?"ErrorCode:"+r.ErrorCode:"error_code:"+r.error_code,action_info:r.ErrorInfo||r.error_msg,time_consume:n.getTimeDiff(e),boardid:null,boardid_list:null},"boardid_list",d),i(o,"to_boardId",null),i(o,"color",null),i(o,"file_id",null),i(o,"file_title",null),o)):s.boardAction("image",(i(a={action_result:0,action_info:null,time_consume:n.getTimeDiff(e),boardid:null,boardid_list:null},"boardid_list",d),i(a,"to_boardId",null),i(a,"color",null),i(a,"file_id",null),i(a,"file_title",null),a))},function(t){var r;s.boardAction("image",(i(r={action_result:-9999,action_info:t&&t.message,time_consume:n.getTimeDiff(e),boardid:null,boardid_list:null},"boardid_list",boardInfoList),i(r,"to_boardId",null),i(r,"color",null),i(r,"file_id",null),i(r,"file_title",null),r))})},a.prototype.reportSwitchBoard=function(t){var e=(new Date).getTime();this.request.reportMsg([{type:"switchBoard",seq:o.getSeq(),content:{boardId:t,updateTime:n.getSecondTime()}}],function(r){r.ErrorCode||r.error_code?s.boardAction("switchBoard",{action_result:r.ErrorCode?"ErrorCode:"+r.ErrorCode:"error_code:"+r.error_code,action_info:r.ErrorInfo||r.error_msg,time_consume:n.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null}):s.boardAction("switchBoard",{action_result:0,action_info:null,time_consume:n.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})},function(r){s.boardAction("switchBoard",{action_result:-9999,action_info:r&&r.message,time_consume:n.getTimeDiff(e),boardid:t,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null})})},a.prototype.reportGlobalBgColor=function(t){var e=(new Date).getTime();this.request.reportMsg([{type:"setGlobalBG",seq:o.getSeq(),content:{updateTime:n.getSecondTime(),colorRGBA:t}}],function(r){r.ErrorCode||r.error_code?s.boardAction("setGlobalBG",{action_result:r.ErrorCode?"ErrorCode:"+r.ErrorCode:"error_code:"+r.error_code,action_info:r.ErrorInfo||r.error_msg,time_consume:n.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null}):s.boardAction("setGlobalBG",{action_result:0,action_info:null,time_consume:n.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})},function(r){s.boardAction("setGlobalBG",{action_result:-9999,action_info:r&&r.message,time_consume:n.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:t,file_id:null,file_title:null})})},a.prototype.reportAddLine=function(t){var e=(new Date).getTime();this.request.reportMsg([{type:"addLine",seq:o.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?s.boardAction("addLine",{action_result:r.ErrorCode?"ErrorCode:"+r.ErrorCode:"error_code:"+r.error_code,action_info:r.ErrorInfo||r.error_msg,time_consume:n.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null}):s.boardAction("addLine",{action_result:0,action_info:null,time_consume:n.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})},function(r){s.boardAction("addLine",{action_result:-9999,action_info:r&&r.message,time_consume:n.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:t.colorRGBA,file_id:null,file_title:null})})},a.prototype.reportDisplayLine=function(t){var e=(new Date).getTime();this.request.reportMsg([{type:"displayLine",seq:o.getSeq(),content:t}],function(r){r.ErrorCode||r.error_code?s.boardAction("displayLine",{action_result:r.ErrorCode?"ErrorCode:"+r.ErrorCode:"error_code:"+r.error_code,action_info:r.ErrorInfo||r.error_msg,time_consume:n.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display}):s.boardAction("displayLine",{action_result:0,action_info:null,time_consume:n.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})},function(r){s.boardAction("displayLine",{action_result:-9999,action_info:r&&r.message,time_consume:n.getTimeDiff(e),boardid:t.boardId,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:null,file_title:null,display:t.display})})},a.prototype.reportGraphData=function(t){var e=(new Date).getTime();this.request.reportMsg(t,function(r){t.forEach(function(t){var o,a;r.ErrorCode||r.error_code?s.boardAction(t.type,(i(o={action_result:r.ErrorCode?"ErrorCode:"+r.ErrorCode:"error_code:"+r.error_code,action_info:r.ErrorInfo||r.error_msg,time_consume:n.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null},"boardid_list",null),i(o,"to_boardId",null),i(o,"color",t.content.colorRGBA),i(o,"file_id",null),i(o,"file_title",null),o)):s.boardAction(t.type,(i(a={action_result:0,action_info:null,time_consume:n.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null},"boardid_list",null),i(a,"to_boardId",null),i(a,"color",t.content.colorRGBA),i(a,"file_id",null),i(a,"file_title",null),a))})},function(r){t.forEach(function(t){var o;s.boardAction(t.type,(i(o={action_result:-9999,action_info:r&&r.message,time_consume:n.getTimeDiff(e),boardid:t.content.boardId,boardid_list:null},"boardid_list",boardInfoList),i(o,"to_boardId",null),i(o,"color",t.content.colorRGBA),i(o,"file_id",null),i(o,"file_title",null),o))})})},a.prototype.reportAddFile=function(t,e){var r=(new Date).getTime();this.request.reportMsg([{type:"addFile",seq:o.getSeq(),content:{updateTime:n.getSecondTime(),fid:t,title:e}}],function(i){i.ErrorCode||i.error_code?s.boardAction("addFile",{action_result:i.ErrorCode?"ErrorCode:"+i.ErrorCode:"error_code:"+i.error_code,action_info:i.ErrorInfo||i.error_msg,time_consume:n.getTimeDiff(r),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:e}):s.boardAction("addFile",{action_result:0,action_info:null,time_consume:n.getTimeDiff(r),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:e})},function(i){s.boardAction("addFile",{action_result:-9999,action_info:i&&i.message,time_consume:n.getTimeDiff(r),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:e})})},a.prototype.reportDeleteFile=function(t){var e=(new Date).getTime();this.request.reportMsg([{type:"deleteFile",seq:o.getSeq(),content:{fid:t,updateTime:n.getSecondTime()}}],function(r){r.ErrorCode||r.error_code?s.boardAction("deleteFile",{action_result:r.ErrorCode?"ErrorCode:"+r.ErrorCode:"error_code:"+r.error_code,action_info:r.ErrorInfo||r.error_msg,time_consume:n.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null}):s.boardAction("deleteFile",{action_result:0,action_info:null,time_consume:n.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})},function(r){s.boardAction("deleteFile",{action_result:-9999,action_info:r&&r.message,time_consume:n.getTimeDiff(e),boardid:null,boardid_list:null,image_url:null,to_boardId:null,color:null,file_id:t,file_title:null})})},t.exports=a},,function(t,e,r){"use strict";var i=r(0),o=r(5);function n(t){if(this.option=Object.assign({},t),!this.option.tlsData)throw new Error("not found tlsData.sdkAppId|tlsData.identifie|tlsData.userSig");if(!this.option.tlsData.sdkAppId)throw new Error("not found tlsData.sdkAppId");if(!this.option.tlsData.identifier)throw new Error("not found tlsData.identifie");if(!this.option.tlsData.userSig)throw new Error("not found tlsData.userSig");this.BOARD_URL=(t.debug?i.TEST_SERVER_URL:i.SERVER_URL)+this.option.tlsData.sdkAppId}n.prototype.initXmlHttp=function(){return XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},n.prototype.getTimeStamp=function(){var t=+new Date;return parseInt(4294967295&t,10)},n.prototype.reportMsg=function(t,e,r){this.option.conf_id&&(t={cmd:"open_conf_svc",sub_cmd:"report_board_data",conf_id:parseInt(this.option.conf_id,10),board_data_list:t},this.post(t,e,r))},n.prototype.getBoardData=function(t,e){var r={cmd:"open_conf_svc",sub_cmd:"get_board_data",conf_id:parseInt(this.option.conf_id,10)};this.post(r,t,e)},n.prototype.getLineData=function(t,e,r){var i=(new Date).getTime(),n={cmd:"open_conf_svc",sub_cmd:"get_line",conf_id:parseInt(this.option.conf_id,10),boardId:t.boardId,owner:t.owner,seq:t.seq};this.post(n,function(t){o.report("getLineData",{action_result:0,time_consume:(new Date).getTime()-i,extra_info:JSON.stringify(t)}),e&&e(t)},function(t){o.report("getLineData",{action_result:-1,time_consume:(new Date).getTime()-i,extra_info:JSON.stringify(t)}),r&&r(t)})},n.prototype.post=function(t,e,r){var i=this.BOARD_URL+"&usersig="+this.option.tlsData.userSig+"&identifier="+this.option.tlsData.identifier;wx.request({url:i,data:t,method:"POST",header:{"content-type":"application/json"},success:function(t){e(t.data)},fail:r})},t.exports=n}])});